<form id="commentForm">
  <input type="text" name="nome" placeholder="Seu nome" required>
  <input type="email" name="email" placeholder="Seu e-mail" required>
  <textarea name="comentario" placeholder="Escreva seu comentário..." required></textarea>
  
  <!-- Campo oculto para identificar o episódio/anime -->
  <input type="hidden" name="pagina" id="pagina">
  
  <button type="submit">Enviar</button>
</form>

<ul id="comentarios-list"></ul>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbxt2_JLXL9jyl2NDr_uPnZ26zcED95LFCt9z6pt1Gv8FcGsXw2S0LsiUzr2s2nnw3Pvwg/exec";

// Definir a URL da página onde está embedado
document.getElementById("pagina").value = window.location.href;

// Envio do comentário
document.getElementById("commentForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  document.getElementById("comentarios-list").innerHTML = "<li>Enviando comentário...</li>";

  await fetch(scriptURL, { method: "POST", body: formData });

  // Atualizar comentários imediatamente após envio
  carregarComentarios();
});

// Carregar comentários
async function carregarComentarios() {
  document.getElementById("comentarios-list").innerHTML = "<li>Carregando comentários...</li>";
  const resp = await fetch(scriptURL + "?pagina=" + encodeURIComponent(window.location.href));
  const comentarios = await resp.json();

  if (comentarios.length === 0) {
    document.getElementById("comentarios-list").innerHTML = "<li>Seja o primeiro a comentar!</li>";
    return;
  }

  document.getElementById("comentarios-list").innerHTML = comentarios.map(c => `
    <li>
      <img src="https://www.gravatar.com/avatar/${c.hash}?s=40&d=identicon" style="border-radius:50%;vertical-align:middle;margin-right:8px;">
      <strong>${c.nome}</strong><br>
      ${c.comentario}
    </li>
  `).join("");
}

// Primeiro carregamento
carregarComentarios();
</script>


<style>
    #comentarios {
        max-width: 600px;
        margin: auto;
        padding: 10px;
    }

    #comentarios-list {
        margin-top: 15px;
    }

    .comentario,
    .resposta {
        border-bottom: 1px solid #ddd;
        padding: 10px;
        display: flex;
        align-items: flex-start;
    }

    .resposta {
        margin-left: 40px;
        background: #f9f9f9;
        border-radius: 5px;
    }

    .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
    }

    form {
        margin-top: 15px;
        display: flex;
        flex-direction: column;
    }

    input,
    textarea {
        margin: 5px 0;
        padding: 8px;
    }

    button {
        padding: 8px;
        background: #007BFF;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
    }

    button:hover {
        background: #0056b3;
    }
</style>
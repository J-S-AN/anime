<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Episódios Assistidos</title>
    <link rel="icon" href="jose.ico" type="jose.ico">
    <meta name="google-adsense-account" content="ca-pub-8906506021952813">
    <style>
        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f0f, #1c1c1c);
            color: #f1f1f1;
            padding: 20px;
            text-align: center;
            min-height: 100vh;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.6);
        }

        #filtros {
            margin-bottom: 25px;
        }

        .btn-filtro {
            background: #222;
            color: #fff;
            border: 2px solid #00d4ff;
            padding: 10px 18px;
            font-size: 15px;
            cursor: pointer;
            border-radius: 8px;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn-filtro:hover {
            background: #00d4ff;
            color: #000;
            transform: translateY(-2px);
        }

        .btn-filtro.ativo {
            background: #00d4ff;
            color: #000;
            font-weight: bold;
            box-shadow: 0 0 12px rgba(0, 212, 255, 0.7);
        }

        #lista-episodios-assistidos {
            list-style: none;
            padding: 0;
            max-width: 800px;
            margin: 0 auto;
        }

        #lista-episodios-assistidos li {
            background: #1e1e1e;
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #lista-episodios-assistidos li:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .btn-remover {
            background: #ff4444;
            color: white;
            border: none;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 14px;
            transition: background 0.3s;
        }

        .btn-remover:hover {
            background: #cc0000;
        }

        .btn-voltar {
            background: #00d4ff;
            color: #000;
            border: none;
            padding: 10px 16px;
            font-size: 15px;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .btn-voltar:hover {
            background: #00a3cc;
            transform: scale(1.05);
        }

        .btn-carregar {
            display: none;
            background: #ffc107;
            color: #000;
            border: none;
            padding: 10px 18px;
            font-size: 15px;
            cursor: pointer;
            border-radius: 8px;
            margin-top: 15px;
            transition: background 0.3s, transform 0.2s;
        }

        .btn-carregar:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        p {
            margin-top: 30px;
            font-size: 14px;
            color: #aaa;
        }
    </style>
</head>

<body>

    

    <button class="btn-voltar" onclick="history.back()">⬅️ Voltar</button>

    <h1>Episódios Assistidos</h1>

    <div id="filtros">
        <button class="btn-filtro ativo" id="btn-todos" onclick="filtrarEpisodios('Todos')">Todos</button>
        <button class="btn-filtro" id="btn-legendado" onclick="filtrarEpisodios('Legendado')">Legendado</button>
        <button class="btn-filtro" id="btn-dublado" onclick="filtrarEpisodios('Dublado')">Dublado</button>
    </div>

    <ul id="lista-episodios-assistidos"></ul>

    <button class="btn-carregar" id="btn-carregar-mais" onclick="carregarMais()">Carregar mais</button>

    <script>
        let todosOsEpisodios = [];
        let episodiosExibidos = 0;
        const LIMITE_INICIAL = 100;
        let filtroAtual = "Todos";

        function carregarEpisodiosAssistidos() {
            let episodiosUnicos = new Set();
            todosOsEpisodios = [];

            for (let i = 0; i < localStorage.length; i++) {
                let chave = localStorage.key(i);
                if (chave.includes("_E")) {
                    let partes = chave.split("_");
                    if (partes.length < 3) continue;

                    let nomeAnime = partes[0].replace(/%20/g, " ");
                    let idioma = partes[1];
                    let episodio = chave.split("_E")[1];

                    episodio = episodio.replace(/T\d+\//, "").replace(/\bepisodio\b/i, "").trim();
                    episodio = episodio.replace(/[^\d]+/g, "");

                    if (episodio && !episodiosUnicos.has(chave)) {
                        episodiosUnicos.add(chave);
                        todosOsEpisodios.push({ chave, nomeAnime, idioma, episodio });
                    }
                }
            }

            todosOsEpisodios.sort((a, b) =>
                a.nomeAnime.localeCompare(b.nomeAnime) ||
                parseInt(a.episodio) - parseInt(b.episodio)
            );

            filtrarEpisodios(filtroAtual);
        }

        function filtrarEpisodios(filtro) {
            filtroAtual = filtro;
            episodiosExibidos = 0;

            document.querySelectorAll(".btn-filtro").forEach(btn => btn.classList.remove("ativo"));
            document.getElementById(`btn-${filtro.toLowerCase()}`).classList.add("ativo");

            let episodiosFiltrados = todosOsEpisodios;
            if (filtro !== "Todos") {
                episodiosFiltrados = todosOsEpisodios.filter(ep => ep.idioma.toLowerCase() === filtro.toLowerCase());
            }

            if (episodiosFiltrados.length === 0) {
                document.getElementById("lista-episodios-assistidos").innerHTML =
                    `<p>Nenhum episódio encontrado para ${filtro}.</p>`;
                document.getElementById("btn-carregar-mais").style.display = "none";
                return;
            }

            mostrarEpisodios(episodiosFiltrados);
        }

        function mostrarEpisodios(lista) {
            let listaAssistidos = document.getElementById("lista-episodios-assistidos");
            listaAssistidos.innerHTML = "";

            let total = lista.length;
            let maxExibir = Math.min(LIMITE_INICIAL, total);
            episodiosExibidos = maxExibir;

            lista.slice(0, maxExibir).forEach(ep => {
                let item = document.createElement("li");
                item.innerHTML = `${ep.nomeAnime} (${ep.idioma}) - Episódio ${ep.episodio} ✅
          <button class="btn-remover" onclick="removerEpisodio('${ep.chave}')">❌</button>`;
                listaAssistidos.appendChild(item);
            });

            document.getElementById("btn-carregar-mais").style.display = total > maxExibir ? "block" : "none";
        }

        function carregarMais() {
            let listaAssistidos = document.getElementById("lista-episodios-assistidos");
            let episodiosFiltrados = todosOsEpisodios.filter(ep => filtroAtual === "Todos" || ep.idioma.toLowerCase() === filtroAtual.toLowerCase());

            let maxExibir = Math.min(episodiosExibidos + 100, episodiosFiltrados.length);
            episodiosFiltrados.slice(episodiosExibidos, maxExibir).forEach(ep => {
                let item = document.createElement("li");
                item.innerHTML = `${ep.nomeAnime} (${ep.idioma}) - Episódio ${ep.episodio} ✅
          <button class="btn-remover" onclick="removerEpisodio('${ep.chave}')">❌</button>`;
                listaAssistidos.appendChild(item);
            });

            episodiosExibidos = maxExibir;
            document.getElementById("btn-carregar-mais").style.display = episodiosExibidos < episodiosFiltrados.length ? "block" : "none";
        }

        function removerEpisodio(chave) {
            localStorage.removeItem(chave);
            carregarEpisodiosAssistidos();
        }

        document.addEventListener("DOMContentLoaded", carregarEpisodiosAssistidos);
    </script>

    <p>Versão 4.0</p>

</body>

</html>
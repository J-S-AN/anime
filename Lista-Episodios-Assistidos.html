<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Episódios Assistidos</title>
    <link rel="icon" href="jose.ico" type="jose.ico">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #fff;
            padding: 20px;
            text-align: center;
        }
        #lista-episodios-assistidos {
            list-style: none;
            padding: 0;
        }
        #lista-episodios-assistidos li {
            background: #333;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn-remover {
            background-color: red;
            color: white;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
        }
        .btn-voltar {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        #btn-carregar-mais {
            display: none;
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <button class="btn-voltar" onclick="history.back()">⬅️ Voltar</button>

    <h1>Episódios Assistidos</h1>
    <ul id="lista-episodios-assistidos"></ul>
    <button id="btn-carregar-mais" onclick="carregarMaisEpisodios()">Carregar mais</button>

    <script>
        let episodiosExibidos = 0;
        let todosOsEpisodios = [];

        function carregarEpisodiosAssistidos() {
            let episodiosUnicos = new Set();

            for (let i = 0; i < localStorage.length; i++) {
                let chave = localStorage.key(i);
                if (chave.includes("_E")) {
                    let partes = chave.split("_");
                    let nomeAnime = partes[0];
                    let idioma = partes[1];
                    let episodio = chave.split("_E")[1];

                    episodio = episodio.replace(/T\d+\//, "");
                    episodio = episodio.replace(/\bepisodio\b/i, "").trim();
                    episodio = episodio.replace(/[^\d]+/g, "");

                    if (episodio && !episodiosUnicos.has(chave)) {
                        episodiosUnicos.add(chave);
                        todosOsEpisodios.push({ chave, nomeAnime, idioma, episodio });
                    }
                }
            }

            // Ordena os episódios pelo nome do anime e número do episódio
            todosOsEpisodios.sort((a, b) => {
                if (a.nomeAnime !== b.nomeAnime) {
                    return a.nomeAnime.localeCompare(b.nomeAnime);
                }
                return parseInt(a.episodio) - parseInt(b.episodio);
            });

            carregarMaisEpisodios();
        }

        function carregarMaisEpisodios() {
            let listaAssistidos = document.getElementById("lista-episodios-assistidos");
            let btnCarregarMais = document.getElementById("btn-carregar-mais");

            let limite = episodiosExibidos + 100;
            for (; episodiosExibidos < limite && episodiosExibidos < todosOsEpisodios.length; episodiosExibidos++) {
                let ep = todosOsEpisodios[episodiosExibidos];
                let item = document.createElement("li");
                item.innerHTML = `${ep.nomeAnime} (${ep.idioma}) - Episódio ${ep.episodio} ✅ 
                    <button class="btn-remover" onclick="removerEpisodio('${ep.chave}')">❌</button>`;
                listaAssistidos.appendChild(item);
            }

            // Se ainda há mais episódios para carregar, exibe o botão
            btnCarregarMais.style.display = episodiosExibidos < todosOsEpisodios.length ? "block" : "none";
        }

        function removerEpisodio(chave) {
            localStorage.removeItem(chave);
            document.getElementById("lista-episodios-assistidos").innerHTML = "";
            episodiosExibidos = 0;
            todosOsEpisodios = [];
            carregarEpisodiosAssistidos();
        }

        document.addEventListener("DOMContentLoaded", carregarEpisodiosAssistidos);
    </script>

    <p>Versão 2.5</p>

</body>
</html>
